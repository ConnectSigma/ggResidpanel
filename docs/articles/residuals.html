<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Overview of Residuals • ggResidpanel</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Overview of Residuals">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ggResidpanel</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">An Introduction to ggResidpanel</a>
    </li>
    <li>
      <a href="../articles/residuals.html">Overview of Residuals</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Overview of Residuals</h1>
                        <h4 class="author">Katherine Goode and Kathleen Rey</h4>
            
            <h4 class="date">March 26, 2019</h4>
      
      
      <div class="hidden name"><code>residuals.Rmd</code></div>

    </div>

    
    
<div id="linear-models" class="section level1">
<h1 class="hasAnchor">
<a href="#linear-models" class="anchor"></a>Linear Models</h1>
<p>The option <code>type</code> in the function <code>resid_panel</code>, <code>resid_compare</code>, and <code>resid_interact</code> offers the options of “response”, “pearson”, or “standardized” for linear models.</p>
<p>By linear models, this text is referring to models of the form: <span class="math inline">\(Y = X\beta+\epsilon\)</span> where <span class="math inline">\(\epsilon \sim N(0,\sigma^2)\)</span>.</p>
<div id="response" class="section level3">
<h3 class="hasAnchor">
<a href="#response" class="anchor"></a>Response</h3>
<p>The “response” residuals are the raw residuals: <span class="math inline">\(y_i-\hat{y_i}\)</span>. In this case, <span class="math inline">\(\hat{y} = X\hat{\beta}\)</span>.</p>
<p>The <code>r</code> code used to obtain the raw residuals from a linear model is: <code><a href="https://www.rdocumentation.org/packages/stats/topics/residuals">resid(model, type="response")</a></code>.</p>
</div>
<div id="pearson" class="section level3">
<h3 class="hasAnchor">
<a href="#pearson" class="anchor"></a>Pearson</h3>
<p>In the case of a linear model, a Pearson residual is simple the raw residual scaled by estimate of the variance of the response variable: <span class="math inline">\(\hat{\sigma}\)</span>. The formula is below:</p>
<p><span class="math inline">\(\frac{y_i-\hat{y_i}}{\sqrt{\hat{\sigma}^2}}\)</span></p>
<p>Selecting the “pearson” option in the <code>resid</code> function does not actually return this result. Thus, the following code is implemented in order to retrieve the Pearson residuals: <code>resid(model, type = "response") / summary(model)$sigma</code></p>
<p><a href="http://support.sas.com/documentation/cdl/en/statug/68162/HTML/default/viewer.htm#statug_intromod_sect046.htm" class="uri">http://support.sas.com/documentation/cdl/en/statug/68162/HTML/default/viewer.htm#statug_intromod_sect046.htm</a></p>
<p><a href="https://v8doc.sas.com/sashtml/insight/chap39/sect56.htm" class="uri">https://v8doc.sas.com/sashtml/insight/chap39/sect56.htm</a></p>
</div>
<div id="standardized" class="section level3">
<h3 class="hasAnchor">
<a href="#standardized" class="anchor"></a>Standardized</h3>
<p><span class="math inline">\(\frac{y_i-\hat{y_i}}{\sqrt{\sigma^2(1-h_{ii})}}\)</span> where <span class="math inline">\(h_{ii}\)</span> is the diagonal from the matrix <span class="math inline">\(X(X'X)^{-1}X'\)</span></p>
<p>This is what ‘stdres(model)’ reports for a linear model.</p>
</div>
</div>
<div id="linear-model" class="section level1">
<h1 class="hasAnchor">
<a href="#linear-model" class="anchor"></a>Linear Model</h1>
<p>‘Proc Reg’ offers raw residuals and studentized residuals (internally). ‘proc glm’ offers raw, internally studentized, and externally studentized residuals.</p>
<p><a href="https://support.sas.com/documentation/cdl/en/statug/63033/HTML/default/viewer.htm#statug_reg_sect034.htm" class="uri">https://support.sas.com/documentation/cdl/en/statug/63033/HTML/default/viewer.htm#statug_reg_sect034.htm</a> <a href="https://support.sas.com/documentation/cdl/en/statug/63033/HTML/default/viewer.htm#statug_glm_sect020.htm" class="uri">https://support.sas.com/documentation/cdl/en/statug/63033/HTML/default/viewer.htm#statug_glm_sect020.htm</a></p>
<p><a href="http://support.sas.com/documentation/cdl/en/statug/63033/HTML/default/viewer.htm#statug_introreg_sect010.htm" class="uri">http://support.sas.com/documentation/cdl/en/statug/63033/HTML/default/viewer.htm#statug_introreg_sect010.htm</a></p>
<p>SAS refers to the residuals as standardized for when <span class="math inline">\(\sigma^2\)</span> is known. SAS refers to the residuals as internally studentized when <span class="math inline">\(s^2\)</span> is used. They are called externally studentized when <span class="math inline">\(s_{-i}^2\)</span> is used.</p>
<p>Scaled (divided by standard deviation) are called pearson.</p>
<p><a href="http://support.sas.com/documentation/cdl/en/statug/63033/HTML/default/viewer.htm#statug_intromod_a0000000355.htm" class="uri">http://support.sas.com/documentation/cdl/en/statug/63033/HTML/default/viewer.htm#statug_intromod_a0000000355.htm</a></p>
<p>Not consistent though and sometimes calls the internally studentized, the standardized residual:</p>
<p><a href="http://support.sas.com/documentation/cdl/en/sgug/59902/HTML/default/viewer.htm#fit_sect54.htm" class="uri">http://support.sas.com/documentation/cdl/en/sgug/59902/HTML/default/viewer.htm#fit_sect54.htm</a></p>
<p><em>SUGGESTION: Only offer raw, pearson, and internally studentized residuals (what stdres does)</em></p>
<div id="deviance-residuals" class="section level4">
<h4 class="hasAnchor">
<a href="#deviance-residuals" class="anchor"></a>Deviance Residuals</h4>
<p><span class="math inline">\(\frac{y_i-\hat{y_i}}{\sqrt{s^2}}\)</span> or <span class="math inline">\(y_i-\hat{y_i}\)</span></p>
<p>I found this in my 520 notes. The first is the scaled deviance. The un-scaled deviance is the raw residuals (page 130 of Dr. Kaiser’s 520 notes).</p>
<p>The function ‘resid(model, type=“deviance”)’ reports the raw residuals.</p>
<p>These don’t really make sense to use for linear models so might want to add in a warning if a person enters a linear model and request deviance residuals.</p>
</div>
<div id="studentized-residuals" class="section level4">
<h4 class="hasAnchor">
<a href="#studentized-residuals" class="anchor"></a>Studentized Residuals</h4>
<p><span class="math inline">\(\frac{y_i-\hat{y_i}}{\sqrt{\sigma_{-i}^2(1-h_{ii})}}\)</span> where <span class="math inline">\(h_{ii}\)</span> is the diagonal from the matrix <span class="math inline">\(X(X'X)^{-1}X'\)</span> and <span class="math inline">\(\sigma_{-i}^2\)</span> is the estimate of the variance of the model not including row <span class="math inline">\(i\)</span>.</p>
<p>This is what ‘studres(model)’ reports for a linear model.</p>
</div>
</div>
<div id="generalized-linear-model" class="section level1">
<h1 class="hasAnchor">
<a href="#generalized-linear-model" class="anchor"></a>Generalized Linear Model</h1>
<p>‘proc genmod’ offers pearson residuals, deviance residuals, raw residuals, standardized pearson residuals, and standardized deviance residuals</p>
<p><a href="https://support.sas.com/documentation/cdl/en/statug/63033/HTML/default/viewer.htm#statug_glm_sect020.htm" class="uri">https://support.sas.com/documentation/cdl/en/statug/63033/HTML/default/viewer.htm#statug_glm_sect020.htm</a></p>
<p>Deviance and standardized deviance:</p>
<p><a href="http://support.sas.com/documentation/cdl/en/sgug/59902/HTML/default/viewer.htm#fit_sect55.htm" class="uri">http://support.sas.com/documentation/cdl/en/sgug/59902/HTML/default/viewer.htm#fit_sect55.htm</a></p>
<p>Pearson and standardized deviance:</p>
<p><a href="http://support.sas.com/documentation/cdl/en/sgug/59902/HTML/default/viewer.htm#fit_sect56.htm" class="uri">http://support.sas.com/documentation/cdl/en/sgug/59902/HTML/default/viewer.htm#fit_sect56.htm</a></p>
<p><em>SUGGESTION: provide raw residuals on ilink scale, deviance, pearson, standardized pearson, and standardized deviance.</em></p>
<div id="raw-residuals" class="section level4">
<h4 class="hasAnchor">
<a href="#raw-residuals" class="anchor"></a>Raw Residuals</h4>
<p><span class="math inline">\(y_i-\hat{\mu_i}\)</span> where <span class="math inline">\(\hat{\mu_i}\)</span> is the prediction with the inverse link function applied.</p>
<p>This is what ‘resid(model, type=“response”)’ returns for a generalized linear. I checked this for Poisson, binomial, and Bernoulli.</p>
</div>
<div id="pearson-residuals-" class="section level4">
<h4 class="hasAnchor">
<a href="#pearson-residuals-" class="anchor"></a>Pearson Residuals.</h4>
<p>Poisson:</p>
<p><span class="math inline">\(\frac{y_i-\hat{\lambda_i}}{\sqrt{\hat{\lambda_i}}}\)</span></p>
<p>Binomial:</p>
<p><span class="math inline">\(\frac{y_i/m_i-\hat{\pi_i}}{\sqrt{\hat{\pi_i}(1-\hat{\pi_i})}}*\sqrt{m_i}\)</span></p>
<p>Bernoulli:</p>
<p><span class="math inline">\(\frac{y_i-\hat{\pi_i}}{\sqrt{\hat{\pi_i}(1-\hat{\pi_i})}}\)</span></p>
<p>This is what the ‘resid(model, type=“pearson”)’ returns for a generalized linear model. I checked this for Poisson, binomial, and Bernoulli.</p>
</div>
<div id="deviance-residuals-1" class="section level4">
<h4 class="hasAnchor">
<a href="#deviance-residuals-1" class="anchor"></a>Deviance Residuals</h4>
<p>Poisson:</p>
<p><span class="math inline">\(sign(y_i-\hat{\lambda_i})\sqrt{2(y_i*log(y_i/\hat{\lambda_i})-(y_i-\hat{\lambda_i}))}\)</span></p>
<p>Binomial:</p>
<p><span class="math inline">\(sign(y_i/m_i-\hat{\pi_i})\sqrt{2(y_ilog(y_i/(m_i\hat{\pi_i}))+(m_i-y_i)log((m_i-y_i)/(m_i-m_i\hat{\pi_i}))}\)</span></p>
<p>Bernoulli:</p>
<p><span class="math inline">\(sign(y_i-\hat{\pi_i})\sqrt{-2(y_ilog(\hat{\pi_i})+(1-y_i)log(1-\hat\pi_i))}\)</span></p>
<p>This is what the ‘resid(model, type=“deviance”)’ returns for a generalized linear model. I checked this for Poisson, binomial, and Bernoulli. I am not sure what is does for when <span class="math inline">\(y_i=0\)</span>.</p>
</div>
<div id="standardized-residuals" class="section level4">
<h4 class="hasAnchor">
<a href="#standardized-residuals" class="anchor"></a>Standardized Residuals</h4>
<p>For each type of residual, for a generalized linear model, SAS uses the formula below. <span class="math inline">\(\frac{r_{type}}{\phi\sqrt{(1-h_{ii})}}\)</span> where <span class="math inline">\(h_{ii}\)</span> is the diagonal from the matrix <span class="math inline">\(W^{1/2}X(X'WX)^{-1}X'W^{1/2}\)</span>.</p>
<p>For Poisson, binomial, and Bernoulli, <span class="math inline">\(\phi\)</span> is assumed to be one.</p>
<p>When I calculated this by hand using the ‘hatvalues’ function, it matched exactly what SAS returned for standardized Pearson and and standardized deviance residuals.</p>
<p>For Gamma and other continuous distributions, the dispersion parameter is estimated using the deviance/residual df. This matches what SAS returns for standardized if set ‘scale=deviance’ in the ‘model’ statement.</p>
<p>I have not found exactly how R is calculating it yet. What I have calculated so far that is closest to stdres is using the deviance/df.residual in place of <span class="math inline">\(\phi\)</span> for all distributions on the ‘pearson’ residuals (for Poisson and binomial). It is different for each distribution.</p>
<p>This was all tested in proc genmod.</p>
<p>‘rstandard’ calculates the standardized deviance residuals just like SAS.</p>
</div>
</div>
<div id="mixed-linear-model" class="section level1">
<h1 class="hasAnchor">
<a href="#mixed-linear-model" class="anchor"></a>Mixed Linear Model</h1>
<p>‘proc mixed’ reports raw (conditional and marginal) residuals, the pearson residuals, and the internally studentized (or standardized) residuals.</p>
<p><a href="https://support.sas.com/documentation/cdl/en/statug/63033/HTML/default/viewer.htm#statug_mixed_sect015.htm" class="uri">https://support.sas.com/documentation/cdl/en/statug/63033/HTML/default/viewer.htm#statug_mixed_sect015.htm</a></p>
<p><a href="https://support.sas.com/documentation/cdl/en/statug/63033/HTML/default/viewer.htm#statug_mixed_sect024.htm" class="uri">https://support.sas.com/documentation/cdl/en/statug/63033/HTML/default/viewer.htm#statug_mixed_sect024.htm</a></p>
<p>Also includes notes on Cook’s D and leverage for mixed linear model. These both lead to acquiring matrices that are not simple (or even possible in some cases) to extract from an lmer object.</p>
<p><em>SUGGESTION: include raw, pearson for now, and eventually internally studentized (standardized) residuals (r is set up to do conditional. Will have to code all by hand if want raw marginal.</em></p>
<div id="raw-residuals-1" class="section level4">
<h4 class="hasAnchor">
<a href="#raw-residuals-1" class="anchor"></a>Raw Residuals</h4>
<p><span class="math inline">\(y_i-\hat{y_i}|blups\)</span></p>
<p>The ‘resid(model, type=“response”)’ gives the raw residuals where the predictions include the blups of the random effects.</p>
</div>
<div id="pearson-residuals" class="section level4">
<h4 class="hasAnchor">
<a href="#pearson-residuals" class="anchor"></a>Pearson Residuals</h4>
<p><em>The ‘resid(model, type=“pearson”)’ does not give the pearson residuals.</em> It gives the raw residuals conditional on the blups.</p>
<p>For the conditional residuals, SAS calculates it in the following way:</p>
<p><span class="math inline">\(\frac{y_i-\hat{y_i}|blups}{\sqrt{\sigma^2}}\)</span> where <span class="math inline">\(\sigma^2\)</span> is the estimate of the residual variance.</p>
</div>
</div>
<div id="mixed-generalized-linear-model" class="section level1">
<h1 class="hasAnchor">
<a href="#mixed-generalized-linear-model" class="anchor"></a>Mixed Generalized Linear Model</h1>
<p>‘proc glimmix’ reports raw (marginal and conditional), pearson, and internally studentized (standardized) residuals.</p>
<p><a href="https://support.sas.com/documentation/cdl/en/statug/63033/HTML/default/viewer.htm#statug_glimmix_a0000001413.htm" class="uri">https://support.sas.com/documentation/cdl/en/statug/63033/HTML/default/viewer.htm#statug_glimmix_a0000001413.htm</a></p>
<p>*SUGGESTION: Include raw, pearson, and deviance as given by the ‘resid’ function. #### Raw Residuals</p>
<p><span class="math inline">\(y_i-\hat{\mu_i}|blups\)</span></p>
<p>The ‘resid(model, type=“response”)’ gives the raw residuals on the ilink scale where the predictions include the blups of the random effects.</p>
<div id="pearson-1" class="section level4">
<h4 class="hasAnchor">
<a href="#pearson-1" class="anchor"></a>Pearson</h4>
<p><span class="math inline">\(raw/sqrt(var(\mu|blups))\)</span></p>
<p>I believe the ‘resid(model, type=“pearson”)’ gives the correct values, but I cannot get SAS to give me pearson residuals on ilink.</p>
</div>
<div id="deviance" class="section level4">
<h4 class="hasAnchor">
<a href="#deviance" class="anchor"></a>Deviance</h4>
<p>I believe the ‘resid(model, type=“deviance”)’ gives the correct values, but I cannot get SAS to give me pearson residuals on ilink. Using the deviance functions for a generalized linear model gives the same results as using ‘resid’</p>
</div>
<div id="scaled" class="section level4">
<h4 class="hasAnchor">
<a href="#scaled" class="anchor"></a>Scaled</h4>
<p>SAS says to take raw residuals and divide by the estimate of the variance of the residuals. I cannot tell if this is just the sample standard deviation of the residuals.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#linear-models">Linear Models</a></li>
      <li><a href="#linear-model">Linear Model</a></li>
      <li><a href="#generalized-linear-model">Generalized Linear Model</a></li>
      <li><a href="#mixed-linear-model">Mixed Linear Model</a></li>
      <li><a href="#mixed-generalized-linear-model">Mixed Generalized Linear Model</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Katherine Goode, Kathleen Rey.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
